(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{2533:(e,n,a)=>{Promise.resolve().then(a.bind(a,3738))},3738:(e,n,a)=>{"use strict";a.r(n),a.d(n,{default:()=>R});var r=a(5155),l=a(3312),t=a(8986),o=a(2133),s=a(5564),i=a(378),d=a(6572),c=a(890),m=a(4039);let h=()=>{let[e,{loading:n,error:a}]=(0,m.n)(i.B$);return{deleteShopById:async n=>{try{var a;let r=await e({variables:{id:n}});return null==r?void 0:null===(a=r.data)||void 0===a?void 0:a.delete_shops_by_pk}catch(e){throw console.error("Error deleting shop:",e),e}},loadingDeleteShop:n,errorDeleteShop:a}},p=()=>{let[e,{loading:n,error:a}]=(0,m.n)(i.zV);return{deleteImageById:async n=>{try{var a;let r=await e({variables:{id:n}});return null==r?void 0:null===(a=r.data)||void 0===a?void 0:a.delete_shop_images_by_pk}catch(e){throw console.error("Error deleting image:",e),e}},loadingDeleteImage:n,errorDeleteImage:a}},u=()=>{let[e,{loading:n,error:a}]=(0,m.n)(i.Ld);return{updateShopById:async n=>{try{var a;let r=await e({variables:n});return null==r?void 0:null===(a=r.data)||void 0===a?void 0:a.update_shops_by_pk}catch(e){throw console.error("Error updating shop by ID:",e),e}},loadingUpdateShop:n,errorUpdateShop:a}};var g=a(698);function x(){let e=(0,g._)(["\n  mutation updateUserByShopId(\n    $shop_id: uuid!\n    $username: String\n    $email: String\n    $phone: String\n    $role: String\n    $updated_at: timestamptz\n  ) {\n    update_users(\n      where: { shop_id: { _eq: $shop_id } }\n      _set: {\n        username: $username\n        email: $email\n        phone: $phone\n        role: $role\n        updated_at: $updated_at\n      }\n    ) {\n      returning {\n        id\n        username\n        email\n        phone\n        role\n        updated_at\n      }\n    }\n  }\n"]);return x=function(){return e},e}let f=(0,a(8247).J1)(x()),_=()=>{let[e,{loading:n,error:a}]=(0,m.n)(f);return{updateUserByShopId:async n=>{try{var a;let r=await e({variables:n});return null==r?void 0:null===(a=r.data)||void 0===a?void 0:a.update_users.returning}catch(e){throw console.error("Error updating user by shop ID:",e),e}},loadingUpdateUser:n,errorUpdateUser:a}};var v=a(9057),j=a(5875),b=a(6486),y=a(4761),w=a(1621),$=a(1496),N=a(7594),S=a(767),k=a(5565),A=a(6046),U=a(2115);let C=e=>{var n;let{id:a}=e,[g,x]=(0,U.useState)([]),[f,C]=(0,U.useState)([]),[R,L]=(0,U.useState)(""),{shopCategories:E}=(0,c.CE)(),[I,D]=(0,U.useState)(!1),{uploadToS3:B}=(0,d.w)(),{toast:H}=(0,s.dj)(),[O]=(0,m.n)(i.XD),{user:J}=(0,c.u8)(a),{shop:z,refetchShop:T}=(0,c._y)(a),{updateShopById:P,loadingUpdateShop:F}=u(),{updateUserByShopId:V}=_(),{images:W,refetchImage:X}=(0,c.yT)(a),{deleteImageById:q,loadingDeleteImage:Q}=p(),{deleteShopById:G,loadingDeleteShop:K}=h(),M=(0,A.useRouter)(),[Y,Z]=(0,U.useState)({id:"",name:"",logo:"",description:"",address:"",phone:"",category_id:"",remark:"",shop_admin_name:"",shop_category:{id:"",name:""}});(0,U.useEffect)(()=>{z&&Z(z)},[z]);let[ee,en]=(0,U.useState)({id:"",username:"",email:"",phone:"",role:""});(0,U.useEffect)(()=>{J&&en(J)},[J]);let ea=async()=>{await G(Y.id)&&M.push("/shop/shop-list")},er=async e=>{let n=await q(e);console.log(n),n&&X()},el=e=>{x(n=>n.filter((n,a)=>a!==e))},et=e=>{C(n=>n.filter((n,a)=>a!==e))},eo=()=>{x([]),C([]),g.forEach(e=>URL.revokeObjectURL(URL.createObjectURL(e))),f.forEach(e=>URL.revokeObjectURL(URL.createObjectURL(e)))},es=async e=>{let n=[];for(let a of g){let r=await B(a);r&&(n.push(r),await O({variables:{shop_id:e,image_url:r}}))}console.log("Uploaded image URLs:",n)},ei=async()=>{await P({id:a,name:Y.name,logo:"",description:Y.description,address:Y.address,phone:Y.phone,category_id:""===R?Y.category_id:R,remark:Y.remark,shop_admin_name:Y.shop_admin_name})&&T()},ed=async()=>{try{D(!0);let e="";if(f.length>0){let n=await B(f[0]);n&&(e=n)}await P({id:a,name:Y.name,logo:""===e?Y.logo:e,description:Y.description,address:Y.address,phone:Y.phone,category_id:""===R?Y.category_id:R,remark:Y.remark,shop_admin_name:Y.shop_admin_name})&&await V({shop_id:a,username:ee.username,email:ee.email,phone:ee.phone,role:ee.role,updated_at:new Date(Date.now()).toISOString()})&&(await Promise.all([es(a)]),X(),T(),H({description:"Shop updated"}))}catch(e){console.log("Error creating product:",e),H({variant:"destructive",title:"Uh oh! Something went wrong.",description:"There was a problem while creating shop.",action:(0,r.jsx)(o.Qg,{altText:"Try again",children:"Try again"})})}finally{eo(),D(!1)}};return(0,r.jsxs)("section",{className:"w-full flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-row items-center gap-2",children:[(0,r.jsx)("div",{className:"h-11 w-11",children:(0,r.jsx)(j.A,{})}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Back to shop list"}),(0,r.jsx)("h1",{className:"text-headercolor font-bold text-xl"})]})]}),(0,r.jsx)("form",{children:(0,r.jsxs)("div",{className:"w-full grid lg:grid-cols-2 lg:gap-x-12 md:grid-cols-1 md:gap-y-8 min-h-32",children:[(0,r.jsxs)("div",{className:"w-[30rem] h-full flex flex-col gap-8",children:[(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Description"}),(0,r.jsxs)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:[(0,r.jsx)("div",{className:"w-1/2",children:(0,r.jsx)(b.A,{name:"name",label:"Shop Name",type:"text",placeHolder:Y.name,value:Y.name,onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value}))})}),(0,r.jsx)(y.A,{placeHolder:Y.description,value:Y.description,onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value})),label:"Shop Description",name:"description"})]})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Category"}),(0,r.jsx)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:(0,r.jsxs)("div",{className:"w-full flex flex-col gap-2",children:[(0,r.jsx)(t.J,{className:"text-inputlabel",children:"Shop Category"}),(0,r.jsx)(w.A,{label:null===(n=Y.shop_category)||void 0===n?void 0:n.name,setCategory:L,options:E})]})})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Shop Address & Contact"}),(0,r.jsxs)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:[(0,r.jsx)(b.A,{name:"address",label:"Shop Address *",type:"text",placeHolder:Y.address,value:Y.address,onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value}))}),(0,r.jsx)(b.A,{name:"shop_phone",label:"Shop Phone Number *",type:"text",placeHolder:Y.phone,value:Y.phone,onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Shop Admin Detail"}),(0,r.jsxs)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:[(0,r.jsx)(b.A,{name:"shop_admin_name",label:"Full Name",type:"text",placeHolder:Y.shop_admin_name,value:Y.shop_admin_name||"",onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value}))}),(0,r.jsx)(b.A,{name:"email",label:"Email *",type:"text",placeHolder:ee.email,value:ee.email||"",onChange:e=>en(n=>({...n,[e.target.name]:e.target.value}))}),(0,r.jsx)(b.A,{name:"phone",label:"Phone Number *",type:"text",placeHolder:ee.phone,value:ee.phone||"",onChange:e=>en(n=>({...n,[e.target.name]:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Authentication Detail"}),(0,r.jsx)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:(0,r.jsx)(b.A,{name:"username",label:"Username *",placeHolder:ee.username,value:ee.username||"",onChange:e=>en(n=>({...n,[e.target.name]:e.target.value})),type:"text"})})]})]}),(0,r.jsxs)("div",{className:"w-[30rem] h-full flex flex-col gap-8",children:[(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Shop Images"}),(0,r.jsxs)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-wrap items-center justify-center gap-6 p-8",children:[(0,r.jsx)($.A,{className:"w-[10rem]",onFileSelect:e=>{x(n=>[...n,...Array.from(e)])},multiple:!0}),W.map((e,n)=>(0,r.jsxs)("div",{className:"w-[10rem] h-[10rem] relative group",children:[(0,r.jsx)(k.default,{src:e.image_url,width:300,height:300,className:"w-full h-full object-cover rounded-md border",alt:"Uploaded image ".concat(n+1)}),(0,r.jsx)("div",{onClick:()=>er(e.id),className:"absolute inset-0 flex items-center justify-center hover:cursor-pointer",children:(0,r.jsx)("div",{className:"group-hover:opacity-100 flex opacity-0 transition-all flex-row items-center px-3 py-1 rounded bg-slate-100",children:Q?(0,r.jsx)(N.A,{className:"animate-spin"}):"Remove"})})]},n)),g.map((e,n)=>(0,r.jsxs)("div",{className:"w-[10rem] h-[10rem] relative",children:[(0,r.jsx)(k.default,{src:URL.createObjectURL(e),width:100,height:100,className:"w-full h-full object-cover rounded-md border",alt:"Uploaded image ".concat(n+1)}),(0,r.jsx)("div",{onClick:()=>el(n),className:"absolute top-1 right-2 hover:cursor-pointer",children:(0,r.jsx)(S.A,{size:30,color:"black"})})]},n))]})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Shop Banner Image"}),(0,r.jsxs)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-wrap items-center justify-center gap-6 p-8",children:[f.length<1&&""===Y.logo?(0,r.jsx)($.A,{className:"w-[10rem]",onFileSelect:e=>{C(n=>[...n,...Array.from(e)])},multiple:!0}):null,f.map((e,n)=>(0,r.jsxs)("div",{className:"w-[10rem] h-[10rem] relative",children:[(0,r.jsx)(k.default,{src:URL.createObjectURL(e),width:100,height:100,className:"w-full h-full object-cover rounded-md border",alt:"Uploaded image ".concat(n+1)}),(0,r.jsx)("div",{onClick:()=>et(n),className:"absolute top-1 right-2 hover:cursor-pointer",children:(0,r.jsx)(S.A,{size:30,color:"black"})})]},n)),""!==Y.logo?(0,r.jsxs)("div",{className:"w-[10rem] h-[10rem] relative group",children:[(0,r.jsx)(k.default,{src:Y.logo,width:300,height:300,className:"w-full h-full object-cover rounded-md border",alt:"banner logo"}),(0,r.jsx)("div",{onClick:ei,className:"absolute inset-0 flex items-center justify-center hover:cursor-pointer",children:(0,r.jsx)("div",{className:"group-hover:opacity-100 flex opacity-0 transition-all flex-row items-center px-3 py-1 rounded bg-slate-100",children:F?(0,r.jsx)(N.A,{className:"animate-spin"}):"Remove"})})]}):null]})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-col gap-2",children:[(0,r.jsx)("h2",{className:"font-bold text-lg text-headercolor",children:"Remark"}),(0,r.jsx)("div",{className:"w-full min-h-20 border border-gray-300 rounded-md flex flex-col gap-6 p-8",children:(0,r.jsx)(y.A,{label:"Remark",name:"remark",placeHolder:Y.remark,value:Y.remark||"",onChange:e=>Z(n=>({...n,[e.target.name]:e.target.value}))})})]}),(0,r.jsxs)("div",{className:"w-full min-h-20 flex flex-row justify-between",children:[(0,r.jsx)("div",{}),(0,r.jsxs)("div",{className:"flex flex-row gap-3",children:[(0,r.jsx)(v.W,{label:"Delete",heading:"Are you sure you want to delete this shop?",caption:"This action will permanently delete this shop from the list",actionDescription:"Deleting the product",action:ea,actionLoading:K}),(0,r.jsx)(l.$,{type:"button",disabled:I,onClick:ed,className:"rounded-md flex items-center justify-center text-white bg-inputlabel min-w-[7rem]",children:I?(0,r.jsx)(N.A,{className:"animate-spin",size:25}):"Update"})]})]})]})]})})]})},R=()=>{let{shopId:e}=(0,A.useParams)();return(0,r.jsx)("div",{className:"",children:(0,r.jsx)(C,{id:e})})}},378:(e,n,a)=>{"use strict";a.d(n,{B$:()=>g,Ld:()=>p,UW:()=>m,XD:()=>h,zV:()=>u});var r=a(698),l=a(8247);function t(){let e=(0,r._)(["\n  mutation createShop(\n   $name: String\n   $logo: String\n   $description: String\n   $address: String\n   $phone: String\n   $category_id: uuid\n   $created_at: timestamptz\n   $remark: String\n   $shop_admin_name: String\n  ) {\n    insert_shops_one(\n      object: {\n        name: $name\n        logo: $logo\n        description: $description\n        address: $address\n        phone: $phone\n        category_id: $category_id\n        created_at: $created_at\n        remark: remark\n        shop_admin_name: $shop_admin_name\n      }\n    ) {\n      id\n      name\n      logo\n      description\n      address\n      phone\n      category_id\n      created_at\n      remark\n      shop_admin_name\n    }\n  }\n"]);return t=function(){return e},e}function o(){let e=(0,r._)(["\n  mutation createUser(\n    $username: String!\n    $email: String!\n    $password: String!\n    $role: String!\n    $shop_id: uuid!\n  ) {\n    insert_users_one(\n      object: {\n        username: $username\n        email: $email\n        password: $password\n        role: $role\n        shop_id: $shop_id\n      }\n    ) {\n      id\n      username\n      email\n      role\n      shop_id\n    }\n  }\n"]);return o=function(){return e},e}function s(){let e=(0,r._)(["\n  mutation createShopImages(\n   $image_url: String\n   $shop_id: uuid\n  ) {\n    insert_shop_images_one(\n      object: {\n        image_url: $image_url\n        shop_id: $shop_id\n      }\n    ) {\n      id\n      image_url\n      shop_id\n    }\n  }\n"]);return s=function(){return e},e}function i(){let e=(0,r._)(["\n  mutation updateShopById(\n    $id: uuid!\n    $name: String\n    $logo: String\n    $description: String\n    $address: String\n    $phone: String\n    $category_id: uuid\n    $remark: String\n    $shop_admin_name: String\n  ) {\n    update_shops_by_pk(\n      pk_columns: { id: $id }\n      _set: {\n        name: $name\n        logo: $logo\n        description: $description\n        address: $address\n        phone: $phone\n        category_id: $category_id\n        remark: $remark\n        shop_admin_name: $shop_admin_name\n      }\n    ) {\n      id\n      name\n      logo\n      description\n      address\n      phone\n      category_id\n      remark\n      shop_admin_name\n    }\n  }\n"]);return i=function(){return e},e}function d(){let e=(0,r._)(["\n  mutation deleteImage($id: uuid!) {\n    delete_shop_images_by_pk(id: $id) {\n      id\n      shop_id\n      image_url\n    }\n  }\n"]);return d=function(){return e},e}function c(){let e=(0,r._)(["\n  mutation deleteShop($id: uuid!) {\n    delete_shops_by_pk(id: $id) {\n      id\n      name\n    }\n  }\n"]);return c=function(){return e},e}let m=(0,l.J1)(t());(0,l.J1)(o());let h=(0,l.J1)(s()),p=(0,l.J1)(i()),u=(0,l.J1)(d()),g=(0,l.J1)(c())}},e=>{var n=n=>e(e.s=n);e.O(0,[586,913,147,244,785,499,273,558,309,7,441,517,358],()=>n(2533)),_N_E=e.O()}]);